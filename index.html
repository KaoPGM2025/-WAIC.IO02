<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Wallet 5.1.0 - Google AI 8.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
            font-size: 16px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
            color: #1e293b;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .category-tag {
            font-size: 0.75rem;
            padding: 4px 12px;
            border-radius: 10px;
            background: #f8fafc;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .countdown-badge {
            font-size: 0.7rem;
            padding: 2px 10px;
            border-radius: 999px;
            background: #fff1f2;
            color: #be123c;
            font-weight: 600;
            border: 1px solid #fecdd3;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-item { animation: fadeIn 0.4s ease-out forwards; }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .ai-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto space-y-6">
        <!-- Header & AI 8.0 Status (Private Engine) -->
        <header class="glass-card p-6 flex flex-col md:flex-row justify-between items-center gap-4 border-t-8 border-cyan-500">
            <div class="flex items-center gap-4">
                <div class="bg-cyan-500 text-white p-4 rounded-[2rem] shadow-lg shadow-cyan-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </div>
                <div>
                    <h1 class="font-bold text-gray-800 text-xl tracking-tight">Smart Wallet 5.1.0-googleAi 8.0</h1>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="relative flex h-2 w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                        </span>
                        <p id="lastUpdate" class="text-emerald-600 text-xs font-bold uppercase tracking-widest">‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (No Cloud)</p>
                    </div>
                </div>
            </div>
            <div id="aiStatus" class="bg-slate-50 p-5 rounded-2xl border border-slate-100 flex-1 w-full">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-cyan-700 font-bold flex items-center gap-2 text-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        AI Private Analysis Engine 8.0
                    </span>
                    <div class="flex gap-2">
                        <button onclick="speakAnalysis()" class="text-slate-400 hover:text-cyan-600 transition p-1" title="‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á AI">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 14.657a1 1 0 01-1.414-1.414A6.001 6.001 0 0013 4.414a1 1 0 011.414-1.414 8 8 0 010 11.657z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
                <p id="aiOutput" class="text-slate-600 text-sm italic leading-relaxed">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</p>
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Balance Card -->
            <div class="glass-card p-6 border-l-8 border-cyan-500 flex flex-col justify-between">
                <div>
                    <h2 class="text-slate-400 text-xs font-bold uppercase tracking-widest">‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h2>
                    <div class="text-4xl font-bold text-slate-800 my-2">‡∏ø <span id="totalBalance">0.00</span></div>
                </div>
                <div id="financialHealth" class="mt-2 text-center py-1.5 rounded-xl text-[10px] font-black uppercase tracking-tighter">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            </div>

            <!-- Savings Goal Card -->
            <div class="glass-card p-6 border-l-8 border-indigo-500 md:col-span-2">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-slate-400 text-xs font-bold uppercase tracking-widest">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏° (Savings Goal)</h2>
                        <div id="goalLabel" class="text-indigo-900 font-bold text-xl mt-1 leading-none">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
                    </div>
                    <button onclick="openGoalModal()" class="bg-indigo-50 text-indigo-600 px-4 py-2 rounded-xl text-xs font-bold hover:bg-indigo-100 transition border border-indigo-100">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
                </div>
                <div class="flex justify-between text-xs mb-2 font-bold text-slate-500">
                    <span id="goalPercentText">0% Completed</span>
                    <span id="goalRemainingText">‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å ‡∏ø0</span>
                </div>
                <div class="w-full bg-slate-100 rounded-full h-3.5 shadow-inner overflow-hidden border border-slate-50">
                    <div id="goalProgress" class="bg-gradient-to-r from-cyan-400 to-indigo-600 h-full rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Inputs & Analytics -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            <!-- Input Form -->
            <div class="glass-card p-6 md:col-span-4 flex flex-col">
                <h2 class="font-bold text-slate-700 mb-6 flex items-center gap-2">
                    <span class="w-8 h-8 rounded-lg bg-cyan-100 text-cyan-600 flex items-center justify-center">‚úçÔ∏è</span>
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
                </h2>
                <div class="space-y-4 flex-1">
                    <div class="group">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-1 mb-1 block">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                        <input type="text" id="desc" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü" class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl focus:ring-2 ring-cyan-500 outline-none transition-all">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-1 mb-1 block">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="amount" placeholder="0.00" class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl focus:ring-2 ring-cyan-500 outline-none transition-all text-xl font-bold">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase ml-1 mb-1 block">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                            <select id="type" class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl text-sm outline-none cursor-pointer">
                                <option value="expense">üìâ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
                                <option value="income">üìà ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase ml-1 mb-1 block">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <select id="category" class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl text-sm outline-none cursor-pointer">
                                <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">üçî ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                                <option value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                                <option value="‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ">üõçÔ∏è ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ</option>
                                <option value="‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á">üé¨ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                                <option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‚ú® ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="addTransaction()" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold shadow-lg shadow-slate-200 hover:bg-slate-900 active:scale-[0.98] transition-all mt-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
                </div>
            </div>

            <!-- Visualization -->
            <div class="glass-card p-6 md:col-span-8 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold text-slate-700">‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</h2>
                    <div class="flex gap-2">
                         <span class="w-3 h-3 rounded-full bg-emerald-400"></span>
                         <span class="w-3 h-3 rounded-full bg-rose-400"></span>
                    </div>
                </div>
                <div class="flex-1 flex items-center justify-center min-h-[320px] relative">
                    <canvas id="financeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- History with Countdown -->
        <div class="glass-card p-6">
            <div class="flex justify-between items-center mb-6 border-b border-slate-50 pb-4">
                <h2 class="font-bold text-slate-700 flex items-center gap-2">
                    üßæ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                    <span class="text-[10px] font-normal text-slate-400 uppercase tracking-widest">(‡∏ã‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏£‡∏ö)</span>
                </h2>
                <div class="flex gap-4">
                    <button onclick="clearAllData()" class="text-xs text-rose-400 hover:text-rose-600 font-bold flex items-center gap-1 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                        ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                </div>
            </div>
            <div id="transactionList" class="space-y-3">
                <!-- Data will be injected here -->
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goalModal" class="fixed inset-0 bg-slate-900/40 hidden backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-[2.5rem] w-full max-w-sm shadow-2xl animate-item">
            <h2 class="font-bold text-2xl mb-1 text-center text-slate-800">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h2>
            <p class="text-xs text-slate-400 text-center mb-6 font-bold uppercase tracking-wider">‡∏£‡∏∞‡∏ö‡∏∏‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
            <div class="space-y-4">
                <div class="relative">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 font-bold">‡∏ø</span>
                    <input type="number" id="targetAmount" class="w-full p-5 pl-10 bg-slate-50 border-2 border-slate-50 rounded-2xl focus:border-cyan-500 outline-none text-2xl font-bold" placeholder="0.00">
                </div>
                <div class="flex gap-3">
                    <button onclick="saveGoal()" class="flex-1 bg-cyan-600 text-white py-4 rounded-2xl font-bold hover:bg-cyan-700 transition shadow-lg shadow-cyan-100">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="closeGoalModal()" class="flex-1 bg-slate-100 text-slate-500 py-4 rounded-2xl font-bold hover:bg-slate-200 transition">‡∏õ‡∏¥‡∏î</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * VERSION 5.1.0-googleAi 8.0 (Offline-First Privacy)
         * - ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡πÉ‡∏ä‡πâ LocalStorage 100% (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï)
         * - AI Core 8.0: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏•‡∏≤‡∏ß‡∏î‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
         * - UI Focus: ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏•‡∏≤‡∏á (Medium) ‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏≤
         */

        let state = {
            transactions: JSON.parse(localStorage.getItem('sw_transactions_v8')) || 
                         JSON.parse(localStorage.getItem('sw_transactions')) || [], // ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å v4/v5 ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ
            goal: parseFloat(localStorage.getItem('sw_goal_v8')) || 
                  parseFloat(localStorage.getItem('sw_goal')) || 0
        };

        let chart = null;

        function saveToLocalStorage() {
            localStorage.setItem('sw_transactions_v8', JSON.stringify(state.transactions));
            localStorage.setItem('sw_goal_v8', state.goal.toString());
            updateUI();
        }

        function addTransaction() {
            const desc = document.getElementById('desc').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;

            if (!desc || isNaN(amount) || amount <= 0) return;

            const newTx = {
                id: 'tx_' + Date.now(),
                description: desc,
                amount: amount,
                type: type,
                category: category,
                timestamp: Date.now(),
                expiresAt: Date.now() + 60000 // ‡∏ã‡πà‡∏≠‡∏ô‡∏à‡∏≤‡∏Å UI ‡πÉ‡∏ô 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            };

            state.transactions.push(newTx);
            saveToLocalStorage();

            // Clear inputs
            document.getElementById('desc').value = '';
            document.getElementById('amount').value = '';
        }

        function saveGoal() {
            const val = parseFloat(document.getElementById('targetAmount').value);
            if (!isNaN(val)) {
                state.goal = val;
                saveToLocalStorage();
                closeGoalModal();
            }
        }

        function clearAllData() {
            if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ? (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡∏ñ‡∏≤‡∏ß‡∏£)')) {
                state.transactions = [];
                state.goal = 0;
                localStorage.removeItem('sw_transactions_v8');
                localStorage.removeItem('sw_goal_v8');
                saveToLocalStorage();
                document.getElementById('aiOutput').innerText = "‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡∏°‡πà";
            }
        }

        function updateUI() {
            const now = Date.now();
            let inc = 0, exp = 0;
            const list = document.getElementById('transactionList');
            list.innerHTML = '';

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            const sorted = [...state.transactions].sort((a, b) => b.timestamp - a.timestamp);

            sorted.forEach(tx => {
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢)
                if (tx.type === 'income') inc += tx.amount;
                else exp += tx.amount;

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö 1 ‡∏ô‡∏≤‡∏ó‡∏µ)
                const timeLeft = Math.max(0, Math.floor((tx.expiresAt - now) / 1000));
                
                if (timeLeft > 0) {
                    const item = document.createElement('div');
                    item.className = 'animate-item flex justify-between items-center p-4 bg-white border border-slate-100 rounded-2xl shadow-sm';
                    item.innerHTML = `
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-2xl bg-slate-50 flex items-center justify-center text-xl shadow-inner">
                                ${getCategoryEmoji(tx.category)}
                            </div>
                            <div>
                                <div class="font-bold text-slate-700 leading-tight">${tx.description}</div>
                                <div class="flex gap-2 items-center mt-1">
                                    <span class="category-tag">${tx.category}</span>
                                    <span class="text-[9px] text-slate-400 font-bold uppercase">${new Date(tx.timestamp).toLocaleTimeString()}</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold ${tx.type === 'income' ? 'text-emerald-500' : 'text-rose-500'} text-lg">
                                ${tx.type === 'income' ? '+' : '-'} ‡∏ø${tx.amount.toLocaleString()}
                            </div>
                            <span class="countdown-badge" data-id="${tx.id}">${timeLeft}s</span>
                        </div>
                    `;
                    list.appendChild(item);
                }
            });

            if (list.innerHTML === '' && state.transactions.length > 0) {
                list.innerHTML = `
                    <div class="text-center py-8 bg-slate-50/50 rounded-2xl border-2 border-dashed border-slate-100">
                        <p class="text-slate-400 text-sm italic">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡πâ‡∏ß (‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏Å‡∏ï‡∏¥)</p>
                    </div>
                `;
            } else if (state.transactions.length === 0) {
                list.innerHTML = `<p class="text-center text-slate-300 py-10 font-bold uppercase tracking-widest text-xs">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>`;
            }

            const bal = inc - exp;
            document.getElementById('totalBalance').innerText = bal.toLocaleString(undefined, { minimumFractionDigits: 2 });
            
            updateStatusLabel(bal, inc, exp);
            updateProgressBar(bal);
            updateChart(inc, exp);
            
            // AI 8.0 ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            if (state.transactions.length > 0) {
                analyzeWithAi(state.transactions, bal);
            }
        }

        function updateStatusLabel(bal, inc, exp) {
            const el = document.getElementById('financialHealth');
            if (state.transactions.length === 0) {
                el.innerText = '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
                el.className = 'mt-2 text-center py-1.5 rounded-xl text-[10px] font-black uppercase bg-slate-100 text-slate-400';
                return;
            }
            if (bal > 0 && exp < inc * 0.4) {
                el.innerText = 'üíé ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏™‡∏π‡∏á';
                el.className = 'mt-2 text-center py-1.5 rounded-xl text-[10px] font-black uppercase bg-emerald-100 text-emerald-600';
            } else if (bal >= 0) {
                el.innerText = '‚öñÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏™‡∏°‡∏î‡∏∏‡∏•‡πÅ‡∏•‡∏∞‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á';
                el.className = 'mt-2 text-center py-1.5 rounded-xl text-[10px] font-black uppercase bg-cyan-100 text-cyan-600';
            } else {
                el.innerText = '‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö';
                el.className = 'mt-2 text-center py-1.5 rounded-xl text-[10px] font-black uppercase bg-rose-100 text-rose-600';
            }
        }

        function updateProgressBar(bal) {
            if (state.goal <= 0) {
                document.getElementById('goalLabel').innerText = '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢';
                document.getElementById('goalPercentText').innerText = '0% Progress';
                document.getElementById('goalRemainingText').innerText = '‡∏ø0.00';
                document.getElementById('goalProgress').style.width = '0%';
                return;
            }
            const prog = Math.min(100, Math.max(0, (bal / state.goal) * 100));
            document.getElementById('goalLabel').innerText = `‡∏≠‡∏≠‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠: ‡∏ø${state.goal.toLocaleString()}`;
            document.getElementById('goalPercentText').innerText = `${prog.toFixed(1)}% ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß`;
            document.getElementById('goalRemainingText').innerText = `‡∏≠‡∏µ‡∏Å ‡∏ø${Math.max(0, state.goal - bal).toLocaleString()} ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢`;
            document.getElementById('goalProgress').style.width = `${prog}%`;
        }

        function updateChart(inc, exp) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if (chart) chart.destroy();
            const hasData = inc > 0 || exp > 0;
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (Income)', '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (Expense)'],
                    datasets: [{
                        data: hasData ? [inc, exp] : [1, 0],
                        backgroundColor: hasData ? ['#06b6d4', '#f43f5e'] : ['#f1f5f9', '#f8fafc'],
                        borderWidth: 8,
                        borderColor: '#ffffff',
                        hoverOffset: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { family: 'Kanit', size: 12 }, usePointStyle: true } },
                        tooltip: { enabled: hasData }
                    }
                }
            });
        }

        async function analyzeWithAi(data, bal) {
            // AI 8.0 ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (Offline Data Analysis Prompt)
            const apiKey = ""; 
            const recent = data.slice(-10).map(t => `${t.description}(${t.amount})`).join(", ");
            const prompt = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${recent}. ‡∏¢‡∏≠‡∏î‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${bal}. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏±‡πâ‡∏ô‡πÜ 2 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ñ‡∏∂‡∏á‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÄ‡∏á‡∏¥‡∏ô 1 ‡∏Ç‡πâ‡∏≠. (‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• 8.0 ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥" }] }
                    })
                });
                const json = await res.json();
                const text = json.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    document.getElementById('aiOutput').innerText = text;
                    document.getElementById('aiStatus').classList.add('ai-pulse');
                    setTimeout(() => document.getElementById('aiStatus').classList.remove('ai-pulse'), 3000);
                }
            } catch (e) {
                document.getElementById('aiOutput').innerText = "AI ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ ‡∏ø" + bal.toLocaleString();
            }
        }

        function speakAnalysis() {
            const text = document.getElementById('aiOutput').innerText;
            if ('speechSynthesis' in window) {
                const msg = new SpeechSynthesisUtterance(text);
                msg.lang = 'th-TH';
                window.speechSynthesis.speak(msg);
            }
        }

        function getCategoryEmoji(cat) {
            const map = {'‡∏≠‡∏≤‡∏´‡∏≤‡∏£': 'üçî', '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á': 'üöó', '‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ': 'üõçÔ∏è', '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á': 'üé¨', '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ': '‚ú®'};
            return map[cat] || 'üí∞';
        }

        window.openGoalModal = () => document.getElementById('goalModal').classList.remove('hidden');
        window.closeGoalModal = () => document.getElementById('goalModal').classList.add('hidden');

        // Countdown Timer for UI hiding
        setInterval(() => {
            const badges = document.querySelectorAll('.countdown-badge');
            let needRefresh = false;
            badges.forEach(b => {
                let v = parseInt(b.innerText);
                if (v > 0) b.innerText = (v - 1) + 's';
                else needRefresh = true;
            });
            if (needRefresh) updateUI();
        }, 1000);

        window.onload = updateUI;
    </script>
</body>
</html>
