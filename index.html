<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Wallet 5.3.0 - MaLi AI (Local Engine)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
            font-size: 16px;
            background: #f8fafc;
            color: #1e293b;
        }

        .glass-card {
            background: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }

        .ai-processing-bar {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }

        .ai-progress-fill {
            height: 100%;
            background: #ec4899;
            width: 0%;
            transition: width 1s linear;
        }

        .countdown-badge {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 12px;
            background: #fff1f2;
            color: #e11d48;
            font-weight: 600;
        }

        @keyframes pulse-pink {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        .mali-active { animation: pulse-pink 2s infinite; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto space-y-6">
        <!-- Header & MaLi AI Status -->
        <header class="glass-card p-6 border-t-8 border-pink-500 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-4">
                <div class="bg-pink-500 text-white p-4 rounded-2xl shadow-lg shadow-pink-100 mali-active">
                    <span class="text-2xl">üå∏</span>
                </div>
                <div>
                    <h1 class="font-bold text-gray-800 text-xl">Smart Wallet 5.3.0-MaLi Ai</h1>
                    <p class="text-pink-600 text-xs font-bold uppercase tracking-widest">Local Offline Engine 100%</p>
                </div>
            </div>

            <div id="aiContainer" class="bg-pink-50 p-5 rounded-2xl border border-pink-100 flex-1 w-full">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-pink-700 font-bold flex items-center gap-2 text-sm">
                        ü§ñ MaLi AI Analysis
                        <span id="aiTimerLabel" class="text-[10px] bg-pink-200 px-2 py-0.5 rounded hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</span>
                    </span>
                    <span id="aiTimeLeft" class="text-[10px] text-pink-400 font-bold"></span>
                </div>
                <p id="aiOutput" class="text-slate-600 text-sm italic">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏∞ ‡∏°‡∏∞‡∏•‡∏¥‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞</p>
                <div class="ai-processing-bar">
                    <div id="aiProgress" class="ai-progress-fill"></div>
                </div>
            </div>
        </header>

        <!-- Financial Overview -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glass-card p-6 border-l-8 border-cyan-500">
                <h2 class="text-slate-400 text-xs font-bold uppercase tracking-widest">‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h2>
                <div class="text-4xl font-bold text-slate-800 my-2">‡∏ø <span id="totalBalance">0.00</span></div>
                <div id="statusLabel" class="inline-block px-3 py-1 rounded-full text-[10px] font-bold bg-slate-100">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
            </div>

            <div class="glass-card p-6 border-l-8 border-indigo-500 md:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-slate-400 text-xs font-bold uppercase tracking-widest">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏° (Savings Goal)</h2>
                    <button onclick="openGoalModal()" class="text-xs text-indigo-600 font-bold hover:underline">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
                </div>
                <div id="goalLabel" class="text-indigo-900 font-bold text-xl mb-2">‡∏ø0.00</div>
                <div class="w-full bg-slate-100 rounded-full h-3 mb-2">
                    <div id="goalProgress" class="bg-indigo-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <p id="goalInfo" class="text-xs text-slate-500 font-medium">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            <!-- Form -->
            <div class="glass-card p-6 md:col-span-4 space-y-4">
                <h2 class="font-bold text-slate-700 flex items-center gap-2">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà</h2>
                <input type="text" id="desc" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 ring-pink-300">
                <input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 ring-pink-300 text-lg font-bold">
                <div class="grid grid-cols-2 gap-2">
                    <select id="type" class="p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none">
                        <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
                        <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                    </select>
                    <select id="category" class="p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none">
                        <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">üçî ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                        <option value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                        <option value="‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ">üõçÔ∏è ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ</option>
                        <option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‚ú® ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
                    </select>
                </div>
                <button onclick="addTransaction()" class="w-full bg-slate-800 text-white py-3 rounded-xl font-bold hover:bg-slate-900 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>

            <!-- Visualization -->
            <div class="glass-card p-6 md:col-span-8 flex flex-col">
                <h2 class="font-bold text-slate-700 mb-4">‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</h2>
                <div class="flex-1 relative min-h-[250px]">
                    <canvas id="financeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent History -->
        <div class="glass-card p-6">
            <h2 class="font-bold text-slate-700 mb-4 flex justify-between">
                <span>üïí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° (‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ)</span>
                <button onclick="clearAllData()" class="text-xs text-slate-400 hover:text-red-500">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </h2>
            <div id="transactionList" class="space-y-2"></div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goalModal" class="fixed inset-0 bg-slate-900/50 hidden backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm shadow-xl">
            <h2 class="font-bold text-xl mb-4 text-center">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h2>
            <input type="number" id="targetAmount" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl mb-4 text-center text-2xl font-bold" placeholder="0.00">
            <div class="flex gap-2">
                <button onclick="saveGoal()" class="flex-1 bg-pink-500 text-white py-3 rounded-xl font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button onclick="closeGoalModal()" class="flex-1 bg-slate-100 text-slate-500 py-3 rounded-xl font-bold">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <script>
        // State Management
        let state = {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ
            transactions: JSON.parse(localStorage.getItem('sw_transactions_v8')) || 
                         JSON.parse(localStorage.getItem('sw_transactions')) || [],
            goal: parseFloat(localStorage.getItem('sw_goal_v8')) || 
                  parseFloat(localStorage.getItem('sw_goal')) || 0,
            isAnalyzing: false
        };

        let chart = null;

        function saveToLocal() {
            localStorage.setItem('sw_transactions_v8', JSON.stringify(state.transactions));
            localStorage.setItem('sw_goal_v8', state.goal.toString());
            updateUI();
        }

        function addTransaction() {
            const desc = document.getElementById('desc').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;
            const cat = document.getElementById('category').value;

            if (!desc || isNaN(amount) || amount <= 0) return;

            const newTx = {
                id: 'tx_' + Date.now(),
                description: desc,
                amount: amount,
                type: type,
                category: cat,
                timestamp: Date.now(),
                expiresAt: Date.now() + 60000 
            };

            state.transactions.push(newTx);
            saveToLocal();
            triggerMaLiAi();

            document.getElementById('desc').value = '';
            document.getElementById('amount').value = '';
        }

        function saveGoal() {
            const val = parseFloat(document.getElementById('targetAmount').value);
            if (!isNaN(val)) {
                state.goal = val;
                saveToLocal();
                closeGoalModal();
            }
        }

        function triggerMaLiAi() {
            if (state.isAnalyzing) return;
            state.isAnalyzing = true;
            
            const aiOutput = document.getElementById('aiOutput');
            const progress = document.getElementById('aiProgress');
            const timerLabel = document.getElementById('aiTimerLabel');
            
            aiOutput.innerText = "‡∏°‡∏∞‡∏•‡∏¥‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì... ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà (60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)";
            timerLabel.classList.remove('hidden');
            
            let startTime = Date.now();
            let duration = 60000; // 1 ‡∏ô‡∏≤‡∏ó‡∏µ

            const interval = setInterval(() => {
                let elapsed = Date.now() - startTime;
                let percent = (elapsed / duration) * 100;
                let remaining = Math.ceil((duration - elapsed) / 1000);
                
                progress.style.width = percent + "%";
                document.getElementById('aiTimeLeft').innerText = remaining + "s";

                if (elapsed >= duration) {
                    clearInterval(interval);
                    state.isAnalyzing = false;
                    progress.style.width = "0%";
                    timerLabel.classList.add('hidden');
                    document.getElementById('aiTimeLeft').innerText = "";
                    runLocalAnalysis();
                }
            }, 100);
        }

        function runLocalAnalysis() {
            // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Logic ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ (‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô API)
            const income = state.transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
            const expense = state.transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
            const bal = income - expense;
            
            let advice = "";
            if (bal < 0) advice = "‡∏°‡∏∞‡∏•‡∏¥‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ' ‡∏•‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞";
            else if (bal < (income * 0.2)) advice = "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ 20% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ô‡∏∞‡∏Ñ‡∏∞";
            else advice = "‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏Ñ‡πà‡∏∞! ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏°‡∏≤‡∏Å ‡∏°‡∏∞‡∏•‡∏¥‡∏Ç‡∏≠‡∏ä‡∏°‡πÄ‡∏ä‡∏¢‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏µ";

            document.getElementById('aiOutput').innerText = `[‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå]: ${advice} (‡∏¢‡∏≠‡∏î‡∏™‡∏∞‡∏™‡∏°‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ‡∏ø${bal.toLocaleString()})`;
        }

        function updateUI() {
            const now = Date.now();
            let inc = 0, exp = 0;
            const list = document.getElementById('transactionList');
            list.innerHTML = '';

            const sorted = [...state.transactions].sort((a, b) => b.timestamp - a.timestamp);

            sorted.forEach(tx => {
                if (tx.type === 'income') inc += tx.amount;
                else exp += tx.amount;

                const timeLeft = Math.max(0, Math.floor((tx.expiresAt - now) / 1000));
                
                if (timeLeft > 0) {
                    const div = document.createElement('div');
                    div.className = "flex justify-between items-center p-3 bg-white border border-slate-100 rounded-xl";
                    div.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-xl">${getEmoji(tx.category)}</span>
                            <div>
                                <div class="font-bold text-sm text-slate-700">${tx.description}</div>
                                <div class="text-[10px] text-slate-400">${new Date(tx.timestamp).toLocaleTimeString()}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold ${tx.type === 'income' ? 'text-green-500' : 'text-red-500'}">
                                ${tx.type === 'income' ? '+' : '-'} ‡∏ø${tx.amount.toLocaleString()}
                            </div>
                            <span class="countdown-badge">${timeLeft}s</span>
                        </div>
                    `;
                    list.appendChild(div);
                }
            });

            const bal = inc - exp;
            document.getElementById('totalBalance').innerText = bal.toLocaleString(undefined, {minimumFractionDigits: 2});
            
            // Status
            const status = document.getElementById('statusLabel');
            if (state.transactions.length === 0) {
                status.innerText = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                status.className = "inline-block px-3 py-1 rounded-full text-[10px] font-bold bg-slate-100 text-slate-400";
            } else if (bal >= 0) {
                status.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏õ‡∏Å‡∏ï‡∏¥";
                status.className = "inline-block px-3 py-1 rounded-full text-[10px] font-bold bg-green-100 text-green-600";
            } else {
                status.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ï‡∏¥‡∏î‡∏•‡∏ö";
                status.className = "inline-block px-3 py-1 rounded-full text-[10px] font-bold bg-red-100 text-red-600";
            }

            // Goal
            const goalProg = document.getElementById('goalProgress');
            if (state.goal > 0) {
                const p = Math.min(100, Math.max(0, (bal / state.goal) * 100));
                document.getElementById('goalLabel').innerText = `‡∏ø${state.goal.toLocaleString()}`;
                document.getElementById('goalInfo').innerText = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${p.toFixed(1)}% (‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å ‡∏ø${Math.max(0, state.goal - bal).toLocaleString()})`;
                goalProg.style.width = p + "%";
            }

            updateChart(inc, exp);
        }

        function updateChart(inc, exp) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if (chart) chart.destroy();
            const hasData = inc > 0 || exp > 0;
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö', '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢'],
                    datasets: [{
                        data: hasData ? [inc, exp] : [1, 0],
                        backgroundColor: hasData ? ['#06b6d4', '#f43f5e'] : ['#f1f5f9', '#f1f5f9'],
                        borderWidth: 5,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function clearAllData() {
            if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á?')) {
                state.transactions = [];
                state.goal = 0;
                saveToLocal();
            }
        }

        function getEmoji(cat) {
            const map = {'‡∏≠‡∏≤‡∏´‡∏≤‡∏£': 'üçî', '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á': 'üöó', '‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ': 'üõçÔ∏è', '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ': '‚ú®'};
            return map[cat] || 'üí∞';
        }

        window.openGoalModal = () => document.getElementById('goalModal').classList.remove('hidden');
        window.closeGoalModal = () => document.getElementById('goalModal').classList.add('hidden');

        // Main Loop
        setInterval(() => {
            updateUI();
        }, 1000);

        window.onload = () => {
            updateUI();
            if (state.transactions.length > 0) triggerMaLiAi();
        };
    </script>
</body>
</html>
