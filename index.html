<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Wallet 5.0.0 - Google AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
            font-size: 16px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .category-tag {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 6px;
            background: #e5e7eb;
            color: #4b5563;
        }

        .countdown-badge {
            font-size: 0.75rem;
            padding: 2px 10px;
            border-radius: 999px;
            background: #fee2e2;
            color: #ef4444;
            font-weight: 600;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto space-y-6">
        <!-- Header & AI Smart Status -->
        <header class="glass-card p-6 flex flex-col md:flex-row justify-between items-center gap-4 border-t-4 border-blue-500">
            <div class="flex items-center gap-4">
                <div class="bg-blue-600 text-white p-3 rounded-2xl shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </div>
                <div>
                    <h1 class="font-bold text-gray-800">Smart Wallet 5.0.0-googleAi</h1>
                    <p class="text-gray-500 text-sm">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span id="lastUpdate">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span></p>
                </div>
            </div>
            <div id="aiStatus" class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-100 flex-1 w-full relative">
                <div class="flex justify-between items-start mb-1">
                    <span class="text-blue-700 font-bold flex items-center gap-2">
                        ü§ñ AI Insights 5.0
                    </span>
                    <button onclick="speakAnalysis()" id="speakBtn" class="text-blue-500 hover:text-blue-700 disabled:opacity-50">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.983 5.983 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.984 3.984 0 00-1.172-2.828a1 1 0 010-1.415z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <p id="aiOutput" class="text-indigo-700 text-sm leading-relaxed italic">‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß...</p>
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Balance Card -->
            <div class="glass-card p-6 border-b-8 border-green-500 flex flex-col justify-between">
                <div>
                    <h2 class="text-gray-500 text-sm font-medium">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h2>
                    <div class="text-3xl font-bold text-gray-800 my-2">‡∏ø <span id="totalBalance">0.00</span></div>
                </div>
                <div class="flex items-center gap-2">
                    <span id="financialHealth" class="px-3 py-1 rounded-full text-xs font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</span>
                </div>
            </div>

            <!-- Savings Goal Card -->
            <div class="glass-card p-6 border-b-8 border-purple-500 md:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-gray-500 text-sm font-medium">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h2>
                    <button onclick="openGoalModal()" class="text-xs bg-purple-100 text-purple-600 px-3 py-1 rounded-lg hover:bg-purple-200">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</button>
                </div>
                <div class="flex justify-between text-sm mb-2 font-bold">
                    <span id="goalLabel" class="text-purple-700">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                    <span id="goalPercent" class="text-purple-600">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                    <div id="goalProgress" class="bg-gradient-to-r from-purple-500 to-indigo-500 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
                <p class="text-xs text-gray-400" id="goalHint">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ç‡∏¢‡∏±‡∏ö</p>
            </div>
        </div>

        <!-- Inputs & Charts -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            <!-- Transaction Input -->
            <div class="glass-card p-6 md:col-span-4">
                <h2 class="font-bold mb-4 text-gray-700 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                    </svg>
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                </h2>
                <div class="space-y-4">
                    <input type="text" id="desc" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡πÅ‡∏ü‡πÄ‡∏ä‡πâ‡∏≤" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 ring-blue-500 outline-none transition">
                    <input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 ring-blue-500 outline-none transition">
                    
                    <div class="grid grid-cols-2 gap-2">
                        <select id="type" class="p-3 bg-gray-50 border border-gray-200 rounded-xl text-sm">
                            <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option>
                            <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option>
                        </select>
                        <select id="category" class="p-3 bg-gray-50 border border-gray-200 rounded-xl text-sm">
                            <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">üçî ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                            <option value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                            <option value="‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ">üõçÔ∏è ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ</option>
                            <option value="‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á">üé¨ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                            <option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‚ú® ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
                        </select>
                    </div>
                    
                    <button onclick="addTransaction()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 active:scale-95 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button>
                </div>
            </div>

            <!-- Analysis Chart -->
            <div class="glass-card p-6 md:col-span-8 overflow-hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold text-gray-700">‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå 5.0</h2>
                    <div class="flex gap-4 text-xs">
                        <span class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded-full"></span> ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 bg-red-500 rounded-full"></span> ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
                    </div>
                </div>
                <div class="h-64 flex items-center justify-center">
                    <canvas id="financeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="glass-card p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold text-gray-700">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ)</h2>
                <span class="text-xs text-gray-400">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏≤‡∏¢</span>
            </div>
            <div id="transactionList" class="divide-y divide-gray-100 max-h-96 overflow-y-auto">
                <!-- Transactions will be injected here -->
                <p class="text-center text-gray-400 py-10">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å Cloud...</p>
            </div>
        </div>
    </div>

    <!-- Modal for Goals -->
    <div id="goalModal" class="fixed inset-0 bg-black/60 hidden backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm shadow-2xl scale-in">
            <h2 class="font-bold text-xl mb-2 text-center">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</h2>
            <p class="text-sm text-gray-500 text-center mb-6">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</p>
            <div class="space-y-4">
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">‡∏ø</span>
                    <input type="number" id="targetAmount" class="w-full p-3 pl-8 border-2 border-gray-100 rounded-xl focus:border-blue-500 outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50000">
                </div>
                <div class="flex gap-3">
                    <button onclick="saveGoal()" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="closeGoalModal()" class="flex-1 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold hover:bg-gray-200 transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, query, addDoc, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'smart-wallet-5-0';

        let user = null;
        let chart = null;
        let transactions = [];
        let savingsGoal = 0;
        let isAiSpeaking = false;

        // --- Core Authentication ---
        async function init() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        }

        onAuthStateChanged(auth, (u) => {
            user = u;
            if (user) {
                document.getElementById('lastUpdate').innerText = new Date().toLocaleTimeString();
                setupDataListeners();
            }
        });

        // --- Real-time Sync ---
        function setupDataListeners() {
            // Listen to Transactions
            const txQuery = collection(db, 'artifacts', appId, 'users', user.uid, 'transactions');
            onSnapshot(txQuery, (snapshot) => {
                transactions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateUI();
            }, (err) => console.error("Snapshot Error:", err));

            // Listen to Goals
            const goalDoc = doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'goal');
            onSnapshot(goalDoc, (docSnap) => {
                if (docSnap.exists()) {
                    savingsGoal = docSnap.data().target || 0;
                    updateUI();
                }
            });
        }

        // --- Actions ---
        window.addTransaction = async () => {
            const desc = document.getElementById('desc').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;

            if (!desc || isNaN(amount) || !user) return;

            const payload = {
                description: desc,
                amount: amount,
                type: type,
                category: category,
                timestamp: Date.now(),
                expiresAt: Date.now() + 60000 
            };

            await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'transactions'), payload);
            
            document.getElementById('desc').value = '';
            document.getElementById('amount').value = '';
        };

        window.saveGoal = async () => {
            const target = parseFloat(document.getElementById('targetAmount').value);
            if (isNaN(target) || !user) return;
            await setDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'goal'), { target });
            closeGoalModal();
        };

        // --- UI Updates ---
        function updateUI() {
            let inc = 0, exp = 0;
            const now = Date.now();
            const list = document.getElementById('transactionList');
            list.innerHTML = '';

            const sorted = [...transactions].sort((a, b) => b.timestamp - a.timestamp);

            if (sorted.length === 0) {
                list.innerHTML = `<p class="text-center text-gray-400 py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!</p>`;
            }

            sorted.forEach(tx => {
                if (tx.type === 'income') inc += tx.amount;
                else exp += tx.amount;

                const timeLeft = Math.max(0, Math.floor((tx.expiresAt - now) / 1000));
                
                if (timeLeft > 0) {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center py-4 animate-fade';
                    div.innerHTML = `
                        <div class="flex gap-4 items-center">
                            <div class="w-10 h-10 rounded-xl bg-gray-50 flex items-center justify-center text-lg">
                                ${getEmoji(tx.category)}
                            </div>
                            <div>
                                <div class="font-bold text-gray-700">${tx.description}</div>
                                <div class="flex gap-2 items-center">
                                    <span class="category-tag">${tx.category}</span>
                                    <span class="text-[10px] text-gray-400">${new Date(tx.timestamp).toLocaleTimeString()}</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold ${tx.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                ${tx.type === 'income' ? '+' : '-'} ‡∏ø${tx.amount.toLocaleString()}
                            </div>
                            <span class="countdown-badge" data-id="${tx.id}">${timeLeft}s</span>
                        </div>
                    `;
                    list.appendChild(div);
                }
            });

            const balance = inc - exp;
            document.getElementById('totalBalance').innerText = balance.toLocaleString(undefined, { minimumFractionDigits: 2 });
            
            updateGoalProgress(balance);
            updateHealth(balance, inc, exp);
            updateChart(inc, exp);
            runAi(transactions, balance);
        }

        function getEmoji(cat) {
            const map = {'‡∏≠‡∏≤‡∏´‡∏≤‡∏£': 'üçî', '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á': 'üöó', '‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ': 'üõçÔ∏è', '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á': 'üé¨', '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ': '‚ú®'};
            return map[cat] || 'üí∞';
        }

        function updateGoalProgress(balance) {
            if (savingsGoal <= 0) return;
            const p = Math.min(100, Math.max(0, (balance / savingsGoal) * 100));
            document.getElementById('goalLabel').innerText = `‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ø${savingsGoal.toLocaleString()}`;
            document.getElementById('goalPercent').innerText = `${p.toFixed(1)}%`;
            document.getElementById('goalProgress').style.width = `${p}%`;
            document.getElementById('goalHint').innerText = p >= 100 ? "üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß" : "‡∏™‡∏π‡πâ‡πÜ ‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß";
        }

        function updateHealth(bal, inc, exp) {
            const el = document.getElementById('financialHealth');
            if (bal > 0 && exp < inc * 0.4) {
                el.innerText = '‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° (‡∏£‡∏ß‡∏¢‡∏°‡∏≤‡∏Å)'; el.className = 'px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700';
            } else if (bal > 0) {
                el.innerText = '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ'; el.className = 'px-3 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-700';
            } else {
                el.innerText = '‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á'; el.className = 'px-3 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700';
            }
        }

        function updateChart(inc, exp) {
            const ctx = document.getElementById('financeChart');
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô'],
                    datasets: [
                        { label: '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö', data: [inc], backgroundColor: '#10b981', borderRadius: 8 },
                        { label: '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢', data: [exp], backgroundColor: '#ef4444', borderRadius: 8 }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { display: false } }, y: { grid: { display: false } } }
                }
            });
        }

        // --- AI 5.0 Logic ---
        async function runAi(data, bal) {
            if (data.length === 0) return;
            const apiKey = "";
            const system = "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Google AI 5.0 ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏ó‡∏¢ ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô‡πÜ (2 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ) ‡πÄ‡∏ô‡πâ‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏≤";
            const prompt = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${JSON.stringify(data.map(t => `${t.description}(${t.category}): ${t.amount} ${t.type}`))}. ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${bal} ‡∏ö‡∏≤‡∏ó.`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: system }] }
                    })
                });
                const json = await res.json();
                const text = json.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) document.getElementById('aiOutput').innerText = text;
            } catch (err) { console.error(err); }
        }

        // AI TTS Fallback using Web Speech API for simplicity
        window.speakAnalysis = () => {
            const text = document.getElementById('aiOutput').innerText;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'th-TH';
            speechSynthesis.speak(utterance);
        };

        // --- Utils ---
        window.openGoalModal = () => document.getElementById('goalModal').classList.remove('hidden');
        window.closeGoalModal = () => document.getElementById('goalModal').classList.add('hidden');

        setInterval(() => {
            document.querySelectorAll('.countdown-badge').forEach(b => {
                let v = parseInt(b.innerText);
                if (v > 0) b.innerText = (v - 1) + 's';
                else updateUI();
            });
        }, 1000);

        init();
    </script>
</body>
</html>
