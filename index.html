<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Wallet 5.1.0 - Google AI 7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
            font-size: 16px;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 1.5rem;
            box-shadow: 0 12px 45px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .category-tag {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 8px;
            background: #f1f5f9;
            color: #64748b;
        }

        .countdown-badge {
            font-size: 0.75rem;
            padding: 2px 12px;
            border-radius: 999px;
            background: #fff1f2;
            color: #e11d48;
            font-weight: 600;
            border: 1px solid #fecdd3;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-item { animation: slideUp 0.3s ease-out forwards; }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto space-y-6">
        <!-- Header & AI 7.0 Status (No Cloud) -->
        <header class="glass-card p-6 flex flex-col md:flex-row justify-between items-center gap-4 border-t-8 border-indigo-600">
            <div class="flex items-center gap-4">
                <div class="bg-indigo-600 text-white p-4 rounded-3xl shadow-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                    </svg>
                </div>
                <div>
                    <h1 class="font-bold text-gray-800 text-xl">Smart Wallet 5.1.0-googleAi 7.0</h1>
                    <p class="text-gray-500 text-sm">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span id="lastUpdate" class="text-emerald-600 font-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (Offline Data)</span></p>
                </div>
            </div>
            <div id="aiStatus" class="bg-indigo-50 p-4 rounded-2xl border border-indigo-100 flex-1 w-full relative group">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-indigo-700 font-bold flex items-center gap-2">
                        ‚ú® AI Financial Analysis 7.0
                    </span>
                    <button onclick="speakAnalysis()" class="text-indigo-400 hover:text-indigo-600 transition" title="‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏ó‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <p id="aiOutput" class="text-indigo-600 text-sm italic leading-relaxed">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</p>
            </div>
        </header>

        <!-- Main Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glass-card p-6 border-l-8 border-emerald-500">
                <h2 class="text-gray-500 text-sm font-semibold uppercase tracking-wider">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h2>
                <div class="text-4xl font-bold text-gray-800 my-3">‡∏ø <span id="totalBalance">0.00</span></div>
                <div id="financialHealth" class="inline-block px-3 py-1 rounded-lg text-xs font-bold uppercase">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            </div>

            <div class="glass-card p-6 border-l-8 border-amber-500 md:col-span-2">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-gray-500 text-sm font-semibold uppercase tracking-wider">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</h2>
                        <div id="goalLabel" class="text-amber-700 font-bold text-lg mt-1">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
                    </div>
                    <button onclick="openGoalModal()" class="bg-amber-100 text-amber-700 px-4 py-2 rounded-xl text-xs font-bold hover:bg-amber-200 transition">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
                </div>
                <div class="flex justify-between text-xs mb-2 font-bold text-gray-600">
                    <span id="goalPercentText">0% ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>
                    <span id="goalRemainingText">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ‡∏ø0</span>
                </div>
                <div class="w-full bg-gray-100 rounded-full h-4 shadow-inner overflow-hidden">
                    <div id="goalProgress" class="bg-gradient-to-r from-amber-400 to-orange-500 h-4 rounded-full transition-all duration-700" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Inputs & Analytics -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            <!-- Form -->
            <div class="glass-card p-6 md:col-span-4">
                <h2 class="font-bold text-gray-700 mb-6 flex items-center gap-2">
                    üì¶ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà
                </h2>
                <div class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-xs text-gray-400 ml-1">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                        <input type="text" id="desc" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°" class="w-full p-3 bg-gray-50 border border-gray-100 rounded-xl focus:ring-2 ring-indigo-500 outline-none transition">
                    </div>
                    <div class="space-y-1">
                        <label class="text-xs text-gray-400 ml-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="amount" placeholder="0.00" class="w-full p-3 bg-gray-50 border border-gray-100 rounded-xl focus:ring-2 ring-indigo-500 outline-none transition text-xl font-bold">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1">
                            <label class="text-xs text-gray-400 ml-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                            <select id="type" class="w-full p-3 bg-gray-50 border border-gray-100 rounded-xl text-sm outline-none">
                                <option value="expense">üìâ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
                                <option value="income">üìà ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs text-gray-400 ml-1">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <select id="category" class="w-full p-3 bg-gray-50 border border-gray-100 rounded-xl text-sm outline-none">
                                <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">üçî ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                                <option value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                                <option value="‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ">üõçÔ∏è ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ</option>
                                <option value="‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á">üé¨ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                                <option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‚ú® ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="addTransaction()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 active:scale-95 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
                </div>
            </div>

            <!-- Chart -->
            <div class="glass-card p-6 md:col-span-8 flex flex-col">
                <h2 class="font-bold text-gray-700 mb-4">‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</h2>
                <div class="flex-1 flex items-center justify-center min-h-[300px]">
                    <canvas id="financeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Transaction History -->
        <div class="glass-card p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="font-bold text-gray-700 flex items-center gap-2">
                    üìë ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                    <span class="text-xs font-normal text-gray-400">(‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢)</span>
                </h2>
                <button onclick="clearAllData()" class="text-xs text-red-400 hover:text-red-600 font-bold">‚ö†Ô∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
            <div id="transactionList" class="space-y-3">
                <p class="text-center text-gray-400 py-10">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤...</p>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goalModal" class="fixed inset-0 bg-gray-900/60 hidden backdrop-blur-md flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm shadow-2xl">
            <h2 class="font-bold text-2xl mb-2 text-center text-gray-800">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</h2>
            <p class="text-sm text-gray-500 text-center mb-6">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏°</p>
            <div class="space-y-4">
                <input type="number" id="targetAmount" class="w-full p-4 border-2 border-gray-50 rounded-2xl focus:border-indigo-500 outline-none text-center text-2xl font-bold" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5000">
                <div class="flex gap-3">
                    <button onclick="saveGoal()" class="flex-1 bg-indigo-600 text-white py-4 rounded-2xl font-bold hover:bg-indigo-700 transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                    <button onclick="closeGoalModal()" class="flex-1 bg-gray-100 text-gray-500 py-4 rounded-2xl font-bold hover:bg-gray-200 transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * VERSION 5.1.0 - Google AI 7.0 (Local Data Focus)
         * - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô LocalStorage (‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠ F5/Refresh)
         * - AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
         * - ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
         */
        
        let state = {
            transactions: JSON.parse(localStorage.getItem('sw_transactions')) || [],
            goal: parseFloat(localStorage.getItem('sw_goal')) || 0
        };

        let chart = null;

        function saveState() {
            localStorage.setItem('sw_transactions', JSON.stringify(state.transactions));
            localStorage.setItem('sw_goal', state.goal.toString());
            updateUI();
        }

        // --- Core Functions ---
        function addTransaction() {
            const desc = document.getElementById('desc').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;

            if (!desc || isNaN(amount) || amount <= 0) return;

            const newTx = {
                id: Date.now().toString(),
                description: desc,
                amount: amount,
                type: type,
                category: category,
                timestamp: Date.now(),
                expiresAt: Date.now() + 60000 // ‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ (60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
            };

            state.transactions.push(newTx);
            saveState();

            document.getElementById('desc').value = '';
            document.getElementById('amount').value = '';
        }

        function saveGoal() {
            const val = parseFloat(document.getElementById('targetAmount').value);
            if (!isNaN(val)) {
                state.goal = val;
                saveState();
                closeGoalModal();
            }
        }

        function clearAllData() {
            const confirmReset = confirm('‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ');
            if(confirmReset) {
                state.transactions = [];
                state.goal = 0;
                saveState();
                document.getElementById('aiOutput').innerText = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...";
            }
        }

        // --- UI Updates ---
        function updateUI() {
            const now = Date.now();
            let totalIncome = 0;
            let totalExpense = 0;
            
            const list = document.getElementById('transactionList');
            list.innerHTML = '';

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠
            const sortedItems = [...state.transactions].sort((a, b) => b.timestamp - a.timestamp);

            sortedItems.forEach(tx => {
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢)
                if (tx.type === 'income') totalIncome += tx.amount;
                else totalExpense += tx.amount;

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ "‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î" (‡∏ã‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ)
                const timeLeft = Math.max(0, Math.floor((tx.expiresAt - now) / 1000));
                
                if (timeLeft > 0) {
                    const item = document.createElement('div');
                    item.className = 'animate-item flex justify-between items-center p-4 bg-white/50 rounded-2xl border border-gray-50';
                    item.innerHTML = `
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-2xl bg-indigo-50 flex items-center justify-center text-xl">
                                ${getEmoji(tx.category)}
                            </div>
                            <div>
                                <div class="font-bold text-gray-700">${tx.description}</div>
                                <div class="flex gap-2 items-center">
                                    <span class="category-tag">${tx.category}</span>
                                    <span class="text-[10px] text-gray-400">${new Date(tx.timestamp).toLocaleTimeString()}</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold ${tx.type === 'income' ? 'text-emerald-500' : 'text-rose-500'} text-lg">
                                ${tx.type === 'income' ? '+' : '-'} ‡∏ø${tx.amount.toLocaleString()}
                            </div>
                            <span class="countdown-badge" data-id="${tx.id}">${timeLeft}s</span>
                        </div>
                    `;
                    list.appendChild(item);
                }
            });

            if (list.innerHTML === '' && state.transactions.length > 0) {
                list.innerHTML = '<p class="text-center text-gray-400 py-10 italic">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∞‡∏™‡∏°‡∏¢‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°)</p>';
            }

            const balance = totalIncome - totalExpense;
            document.getElementById('totalBalance').innerText = balance.toLocaleString(undefined, { minimumFractionDigits: 2 });
            
            updateFinancialHealthStatus(balance, totalIncome, totalExpense);
            updateGoalProgressUI(balance);
            updateChartAnalytics(totalIncome, totalExpense);
            
            // AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            if (state.transactions.length > 0) {
                runAiFinancialAnalysis(state.transactions, balance);
            }
        }

        function updateFinancialHealthStatus(bal, inc, exp) {
            const el = document.getElementById('financialHealth');
            if (state.transactions.length === 0) {
                el.innerText = '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
                el.className = 'inline-block px-3 py-1 rounded-lg text-xs font-bold uppercase bg-gray-100 text-gray-500';
                return;
            }

            if (bal > 0 && exp < inc * 0.5) {
                el.innerText = '‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢';
                el.className = 'inline-block px-3 py-1 rounded-lg text-xs font-bold uppercase bg-emerald-100 text-emerald-700';
            } else if (bal >= 0) {
                el.innerText = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏°‡∏î‡∏∏‡∏•';
                el.className = 'inline-block px-3 py-1 rounded-lg text-xs font-bold uppercase bg-blue-100 text-blue-700';
            } else {
                el.innerText = '‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô';
                el.className = 'inline-block px-3 py-1 rounded-lg text-xs font-bold uppercase bg-rose-100 text-rose-700';
            }
        }

        function updateGoalProgressUI(balance) {
            if (state.goal <= 0) {
                document.getElementById('goalLabel').innerText = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢';
                document.getElementById('goalPercentText').innerText = '0%';
                document.getElementById('goalRemainingText').innerText = '‡∏ø0';
                document.getElementById('goalProgress').style.width = '0%';
                return;
            }
            const progress = Math.min(100, Math.max(0, (balance / state.goal) * 100));
            document.getElementById('goalLabel').innerText = `‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ø${state.goal.toLocaleString()}`;
            document.getElementById('goalPercentText').innerText = `${progress.toFixed(1)}% ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`;
            document.getElementById('goalRemainingText').innerText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ‡∏ø${Math.max(0, state.goal - balance).toLocaleString()}`;
            document.getElementById('goalProgress').style.width = `${progress}%`;
        }

        function updateChartAnalytics(inc, exp) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if (chart) chart.destroy();
            
            const hasData = inc > 0 || exp > 0;
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'],
                    datasets: [{
                        data: hasData ? [inc, exp] : [1, 0], 
                        backgroundColor: hasData ? ['#10b981', '#f43f5e'] : ['#e2e8f0', '#f1f5f9'],
                        borderWidth: 5,
                        borderColor: '#ffffff',
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { family: 'Kanit' } } },
                        tooltip: { enabled: hasData }
                    }
                }
            });
        }

        async function runAiFinancialAnalysis(data, bal) {
            // AI ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á
            const apiKey = ""; // API Key ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
            const recentData = data.slice(-5).map(t => `${t.description}(${t.amount}‡∏ö.)`).join(", ");
            const prompt = `‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${recentData} ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏µ‡πà ${bal} ‡∏ö‡∏≤‡∏ó ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏±‡πâ‡∏ô‡πÜ 2 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏â‡∏•‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡πÄ‡∏î‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏±‡πà‡∏ß" }] }
                    })
                });
                const json = await res.json();
                const text = json.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    document.getElementById('aiOutput').innerText = text;
                }
            } catch (e) { 
                console.error("AI Analysis Error:", e);
                document.getElementById('aiOutput').innerText = "AI ‡∏ï‡∏¥‡∏î‡∏Ç‡∏±‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÅ‡∏ï‡πà‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ " + bal.toLocaleString() + " ‡∏ö‡∏≤‡∏ó";
            }
        }

        function speakAnalysis() {
            const text = document.getElementById('aiOutput').innerText;
            if ('speechSynthesis' in window) {
                const msg = new SpeechSynthesisUtterance(text);
                msg.lang = 'th-TH';
                window.speechSynthesis.speak(msg);
            }
        }

        // --- Helpers ---
        function getEmoji(cat) {
            const m = {'‡∏≠‡∏≤‡∏´‡∏≤‡∏£': 'üçî', '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á': 'üöó', '‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ': 'üõçÔ∏è', '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á': 'üé¨', '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ': '‚ú®'};
            return m[cat] || 'üí∞';
        }

        window.openGoalModal = () => document.getElementById('goalModal').classList.remove('hidden');
        window.closeGoalModal = () => document.getElementById('goalModal').classList.add('hidden');

        // Countdown Timer for hidden UI items (Runs every second)
        setInterval(() => {
            const badges = document.querySelectorAll('.countdown-badge');
            let needsUpdate = false;
            badges.forEach(b => {
                let v = parseInt(b.innerText);
                if (v > 0) b.innerText = (v - 1) + 's';
                else needsUpdate = true;
            });
            if (needsUpdate) updateUI();
        }, 1000);

        // Initial Load on startup
        window.onload = updateUI;
    </script>
</body>
</html>
